概念自适应演化
┌─────────────────────────────────────────────────────────────────┐
│                     状态-动作数据收集                            │
│                                                                 │
│  ┌───────────────┐                  ┌───────────────┐           │
│  │   状态数据    │                  │   动作数据    │           │
│  │  (states)     │                  │  (actions)    │           │
│  └───────┬───────┘                  └───────────────┘           │
│          │                                                      │
└──────────┼──────────────────────────────────────────────────────┘
           │
           ▼
┌──────────────────────────────────────────────────────────────────┐
│                        初始概念生成                               │
│                                                                  │
│  ┌───────────────┐     ┌───────────────┐    ┌────────────────┐   │
│  │ CLIP编码状态  │────▶│ KMeans聚类    │───▶│ 为每个聚类中心 │   │
│  │ 特征表示      │     │ n_clusters=6  │    │ 生成概念描述   │   │
│  └───────────────┘     └───────────────┘    │                │   │
│                                             │                │   │
│                        ┌───────────────┐    │  GPT2文本生成  │   │
│                        │ 任务相关提示词│───▶│  每个概念3个变体│   │
│                        │ task_prompts  │    └────────┬───────┘   │
│                        └───────────────┘             │           │
│                                                      │           │
│                                                      ▼           │
│                                             ┌────────────────┐   │
│                                             │ 初始概念集合   │   │
│                                             │ initial_concepts│   │
│                                             └────────┬───────┘   │
└──────────────────────────────────────────────────────┼───────────┘
                                                       │
                                                       ▼
┌──────────────────────────────────────────────────────────────────┐
│                        适应度评估                                 │
│                                                                  │
│  ┌────────────────────┐    ┌────────────────────┐                │
│  │ CLIP编码所有概念   │    │ CLIP编码所有状态   │                │
│  │ text_features      │    │ state_features     │                │
│  └──────────┬─────────┘    └──────────┬─────────┘                │
│             │                         │                          │
│             └──────────┬─────────────┘                          │
│                        │                                         │
│                        ▼                                         │
│              ┌────────────────────┐                              │
│              │ 计算状态-概念相似度 │                              │
│              │ similarities       │                              │
│              └──────────┬─────────┘                              │
│                         │                                         │
│              ┌──────────┴─────────┐                              │
│              │                    │                              │
│              ▼                    ▼                              │
│  ┌────────────────────┐  ┌────────────────────┐                  │
│  │ 状态内部一致性计算  │  │ 动作内部一致性计算  │                  │
│  │ state_consistency  │  │ action_consistency │                  │
│  └──────────┬─────────┘  └──────────┬─────────┘                  │
│             │                       │                            │
│             └──────────┬────────────┘                            │
│                        │                                         │
│                        ▼                                         │
│              ┌────────────────────┐                              │
│              │ 综合适应度计算      │                              │
│              │ fitness = 相似度    │                              │
│              │   * 状态一致性      │                              │
│              │   * 动作一致性      │                              │
│              └──────────┬─────────┘                              │
│                         │                                        │
│                         ▼                                        │
│              ┌────────────────────┐                              │
│              │ 适应度分数字典      │                              │
│              │ fitness_scores     │                              │
│              └──────────┬─────────┘                              │
└───────────────────────────────────────────────────┼──────────────┘
                                                   │
                                                   ▼
┌──────────────────────────────────────────────────────────────────┐
│                        概念演化                                   │
│                                                                  │
│  ┌────────────────────┐                                          │
│  │ 计算每个变体的      │                                          │
│  │ 平均相似度         │                                          │
│  └──────────┬─────────┘                                          │
│             │                                                    │
│             ▼                                                    │
│  ┌────────────────────┐                                          │
│  │ 为每个概念确定     │                                          │
│  │ 最佳变体           │                                          │
│  └──────────┬─────────┘                                          │
│             │                                                    │
│             ▼                                                    │
│  ┌─────────────────────────────────────┐                         │
│  │          适应度判断                  │                         │
│  └─────────────────────────────────────┘                         │
│             │                                                    │
│    ┌────────┴────────┐                                           │
│    │                 │                                           │
│    ▼                 ▼                                           │
│┌────────────────┐ ┌────────────────────┐                         │
││ 高适应度概念   │ │ 低适应度概念       │                         │
││ (fitness > 0.5)│ │ (fitness <= 0.5)   │                         │
││                │ │                    │                         │
││ 保持原有变体   │ │ 保留最佳变体 +     │                         │
│└────────────────┘ │ GPT2生成新变体     │                         │
│                   └─────────┬──────────┘                         │
│                             │                                    │
│                             ▼                                    │
│                   ┌────────────────────┐                         │
│                   │ 组合新的概念集合   │                         │
│                   │ new_concepts       │                         │
│                   └─────────┬──────────┘                         │
│                             │                                    │
│                             ▼                                    │
│                   ┌────────────────────┐                         │
│                   │ 记录概念演化历史   │                         │
│                   │ concept_history    │                         │
│                   └────────────────────┘                         │
└──────────────────────────────────────────────────────────────────┘
                            │
                            │ 迭代
                            ▼
                   ┌────────────────────┐
                   │ 返回到适应度评估   │
                   │ 继续优化           │
                   └────────────────────┘



频域与语义空间融合优化流程图
┌─────────────────┐                             ┌─────────────────┐
│  图像输入 (x)   │                             │  概念文本描述   │
└────────┬────────┘                             └────────┬────────┘
         │                                               │
         ▼                                               ▼
┌─────────────────┐                             ┌─────────────────┐
│   初始卷积层    │                             │    CLIP编码     │
└────────┬────────┘                             └────────┬────────┘
         │                                               │
         ▼                                               │
┌─────────────────┐                                      │
│  傅里叶变换(FFT)│                                      │
│  x → x_fft      │                                      │
└────────┬────────┘                                      │
         │                                               │
         ├───────────────────┐                           │
         │                   ▼                           │
         │          ┌─────────────────┐                  │
         │          │频域特征→语义映射│                  │
         │          │freq_to_semantic │                  │
         │          └────────┬────────┘                  │
         │                   │                           │
         │                   ▼                           ▼
         │          ┌─────────────────────────────────────┐
         │          │    计算语义相似度                   │
         │          │    similarity = cos(freq, concept)  │
         │          └────────┬────────────────────────────┘
         │                   │
         │                   ▼
         │          ┌─────────────────┐
         │          │选择最相似的概念 │
         │          │best_concept_idx │
         │          └────────┬────────┘
         │                   │
         │                   ▼
         │          ┌─────────────────┐
         │          │语义特征→频域映射│
         │          │semantic_attention│
         │          └────────┬────────┘
         │                   │
         │                   ▼
         │          ┌─────────────────┐
         │          │ 生成注意力权重  │
         │          │attention_weights│
         │          └────────┬────────┘
         │                   │
         ▼                   ▼
┌───────────────────────────────────┐
│       频谱增强                    │
│x_fft *= (1 + semantic_weight * attention_weights)│
└────────┬──────────────────────────┘
         │
         ▼
┌─────────────────┐
│卷积核傅里叶变换 │
│kernel_fft       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 频域中应用卷积  │
│out_fft          │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 逆傅里叶变换    │
│    IFFT         │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 残差连接和输出  │
│output = IFFT + conv_out + bias│
└─────────────────┘





跨任务概念迁移
┌─────────────────────────────────────────────────────────────────────┐
│                          概念知识库                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌───────────────┐     ┌───────────────┐     ┌───────────────┐     │
│  │   任务A概念库  │     │   任务B概念库  │     │   任务C概念库  │     │
│  │  [{概念变体},  │     │  [{概念变体},  │     │  [{概念变体},  │     │
│  │   适应度分数]  │     │   适应度分数]  │     │   适应度分数]  │     │
│  └───────┬───────┘     └───────┬───────┘     └───────┬───────┘     │
│          │                     │                     │             │
│  ┌───────┴─────────────────────┴─────────────────────┴───────┐     │
│  │                       元数据管理                          │     │
│  │  • 任务信息 {domain, task_name, concept_files}            │     │
│  │  • 概念信息 {concept_id, task, domain, variants, fitness}  │     │
│  │  • 迁移历史 {query_concept, similar_concepts, timestamp}   │     │
│  └───────────────────────────────────────────────────────────┘     │
│                                                                     │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        跨任务概念迁移操作                           │
└───────────┬─────────────────────┬─────────────────────┬─────────────┘
            │                     │                     │
            ▼                     ▼                     ▼
┌───────────────────┐    ┌──────────────────┐   ┌──────────────────┐
│   相似概念查找    │    │    渐进式迁移     │   │   混合概念生成   │
├───────────────────┤    ├──────────────────┤   ├──────────────────┤
│1.编码查询概念     │    │1.获取源任务概念   │   │1.查找相关概念    │
│  CLIP文本编码     │    │                  │   │                  │
│                   │    │2.获取目标任务概念 │   │2.选择基础变体    │
│2.编码库中所有概念 │    │                  │   │                  │
│  CLIP文本编码     │    │3.计算概念间相似度 │   │3.随机选择库中    │
│                   │    │  余弦相似度匹配   │   │  概念进行混合    │
│3.计算相似度矩阵   │    │                  │   │                  │
│  torch.mm         │    │4.匹配源目标概念对 │   │4.GPT2生成混合描述│
│                   │    │                  │   │                  │
│4.为每个查询概念   │    │5.根据适应级别     │   │5.创建新的变体集  │
│  找到top-k相似概念│    │  混合源目标概念   │   │                  │
│                   │    │  num_source =    │   │                  │
│5.合并原始变体和   │    │  (1-level)*len   │   │                  │
│  相似概念         │    │  num_target =    │   │                  │
│                   │    │  level*len       │   │                  │
└────────┬──────────┘    └────────┬─────────┘   └────────┬─────────┘
         │                        │                      │
         │                        │                      │
         ▼                        ▼                      ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          增强概念集                                 │
│                                                                     │
│  ┌───────────────┐     ┌───────────────┐     ┌───────────────┐     │
│  │  增强概念1     │     │  增强概念2     │     │  增强概念3     │     │
│  │ [原始变体 +    │     │ [源任务变体 +  │     │ [混合生成的    │     │
│  │  相似变体]     │     │  目标任务变体] │     │  新变体]       │     │
│  └───────────────┘     └───────────────┘     └───────────────┘     │
│                                                                     │
└─────────────────────────────────┬───────────────────────────────────┘
                                  │
                                  ▼
                        ┌───────────────────┐
                        │   用于新任务学习   │
                        │  增强的概念引导   │
                        └───────────────────┘



CLIP引导的双模拟损失
┌───────────────────────────────────────────────────────────────────────────────────────┐
│                               输入                                                     │
│                                                                                       │
│   ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌────────────┐ │
│   │   状态特征      │    │     动作        │    │  CLIP相似度      │    │ 类别标签   │ │
│   │ state_features  │    │    actions      │    │ clip_similarities│    │class_labels│ │
│   └────────┬────────┘    └────────┬────────┘    └────────┬────────┘    └─────┬──────┘ │
└────────────┼─────────────────────┼─────────────────────┼─────────────────────┼─────────┘
             │                     │                     │                     │
             │                     │                     │                     │
             ▼                     ▼                     │                     │
┌────────────────────────────────────────────┐           │                     │
│       语义类内一致性损失                    │           │                     │
│                                            │           │                     │
│  ┌────────────────────────────────┐        │           │                     │
│  │ 1. 按类别分组样本               │        │           │                     │
│  └────────────────┬───────────────┘        │           │                     │
│                   │                         │           │                     │
│  ┌────────────────▼───────────────┐        │           │                     │
│  │ 2. 计算每个类别的平均特征和动作  │        │           │                     │
│  └────────────────┬───────────────┘        │           │                     │
│                   │                         │           │                     │
│  ┌────────────────▼───────────────┐        │           │                     │
│  │ 3. 计算每个样本到类别平均值的距离│        │           │                     │
│  └────────────────┬───────────────┘        │           │                     │
│                   │                         │           │                     │
│  ┌────────────────▼───────────────┐        │           │                     │
│  │ 4. 汇总所有类别的特征和动作一致性│        │           │                     │
│  └────────────────┬───────────────┘        │           │                     │
│                   │                         │           │                     │
└───────────────────┼─────────────────────────┘           │                     │
                    │                                     │                     │
                    ▼                                     ▼                     ▼
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                         CLIP引导的双模拟损失                                          │
│                                                                                      │
│  ┌────────────────────────────────┐       ┌────────────────────────────────┐         │
│  │ 1. 计算状态特征的距离矩阵       │       │ 2. 计算动作的距离矩阵           │         │
│  │    state_dists = cdist(state)  │       │    action_dists = cdist(action) │         │
│  └────────────────┬───────────────┘       └────────────────┬───────────────┘         │
│                   │                                         │                         │
│  ┌────────────────▼───────────────────────────────────────┬┘                         │
│  │                                                        │                          │
│  │  ┌────────────────────────────────┐                    │                          │
│  │  │ 3. 归一化CLIP相似度            │                    │                          │
│  │  │    normalized_sims = normalize │                    │                          │
│  │  └────────────────┬───────────────┘                    │                          │
│  │                   │                                    │                          │
│  │  ┌────────────────▼───────────────┐                    │                          │
│  │  │ 4. 计算CLIP相似度矩阵          │                    │                          │
│  │  │    clip_sims = mm(norm, norm.T)│                    │                          │
│  │  └────────────────┬───────────────┘                    │                          │
│  │                   │                                    │                          │
│  │  ┌────────────────▼───────────────┐                    │                          │
│  │  │ 5. 转换为距离 (1-相似度)       │                    │                          │
│  │  │    clip_dists = 1.0 - clip_sims│                    │                          │
│  │  └────────────────┬───────────────┘                    │                          │
│  │                   │                                    │                          │
│  └───────────────────┼────────────────────────────────────┘                          │
│                      │                                                               │
│  ┌────────────────────────────────┐       ┌────────────────────────────────┐         │
│  │ 6. 状态特征距离与CLIP距离对齐   │       │ 7. 动作距离与CLIP距离对齐       │         │
│  │    state_clip_loss = MSE       │       │    action_clip_loss = MSE       │         │
│  └────────────────┬───────────────┘       └────────────────┬───────────────┘         │
│                   │                                         │                         │
│  ┌────────────────▼─────────────────────────────────────────▼───────────────┐         │
│  │ 8. 组合损失                                                               │         │
│  │    clip_bisim_loss = state_clip_loss + action_clip_loss                  │         │
│  └────────────────┬────────────────────────────────────────────────────────┘         │
│                   │                                                                   │
└───────────────────┼──────────────────────────────────────────────────────────────────┘
                    │                    
                    ▼                   
┌──────────────────────────────────────────────────────────┐
│                   总损失计算                             │
│                                                         │
│  ┌────────────────────────────────────────┐             │
│  │ 1. 应用权重                            │             │
│  │    sc_loss_weighted = λ_SC * sc_loss   │             │
│  │    bisim_loss_weighted = λ_clip * clip_bisim_loss   │             │
│  └────────────────┬───────────────────────┘             │
│                   │                                     │
│  ┌────────────────▼───────────────────────┐             │
│  │ 2. 合并损失                            │             │
│  │    total_loss = sc_loss_weighted + bisim_loss_weighted │             │
│  └────────────────┬───────────────────────┘             │
└────────────────────────────────────────────────────────┘
                    │
                    ▼
┌────────────────────────────────────────────────────────┐
│                     输出                               │
│                                                        │
│  ┌────────────────────┐    ┌─────────────────────┐    │
│  │    总损失          │    │   各部分损失元组     │    │
│  │    total_loss      │    │   (sc_loss, bisim)  │    │
│  └────────────────────┘    └─────────────────────┘    │
│                                                        │
└────────────────────────────────────────────────────────┘



vis  clip_vis example 之间的关系
┌──────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       环境与模型层                                             │
│                                                                                              │
│   ┌─────────────┐       ┌──────────────┐       ┌────────────────┐        ┌──────────────┐    │
│   │ 环境生成状态 │──────▶│ 强化学习代理  │◀─────▶│ CLIP模型      │        │ 模型选择与加载│    │
│   │ (DMControl) │       │ (HiFNO_Agent) │      │ (CLIP ViT-B/32)│◀───────│ (load_model) │    │
│   └─────────────┘       └──────────────┘       └────────────────┘        └──────────────┘    │
│          │                      │                      │                        │            │
└──────────┼──────────────────────┼──────────────────────┼────────────────────────┼────────────┘
           │                      │                      │                        │
           ▼                      │                      │                        │
┌──────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       基础可视化层 (vis.py)                                   │
│                                                                                              │
│   ┌─────────────────────┐      ┌────────────────────┐     ┌─────────────────────────┐        │
│   │ 状态收集与预处理     │      │ 状态分类与聚类      │     │ 可视化生成               │        │
│   │ collect_walker_states│─────▶│ classify_state     │────▶│ visualize_classification│        │
│   │ preprocess_state    │      │ cluster_states     │     │ visualize_clustering    │        │
│   └─────────────────────┘      └────────────────────┘     │ visualize_tsne          │        │
│                                        │                  │ create_reward_class_plot │        │
│                                        │                  └─────────────────────────┘        │
│                                        │                              │                      │
└────────────────────────────────────────┼──────────────────────────────┼──────────────────────┘
                                         │                              │
                                         ▼                              ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   命令行接口层 (clip_vis.py)                                  │
│                                                                                              │
│   ┌────────────────┐     ┌────────────────────┐      ┌────────────────────────────┐          │
│   │ 参数解析与配置  │────▶│ 运行模式选择        │─────▶│ 可视化执行                 │          │
│   │ parse_args     │     │ interactive/episode │      │ run_interactive_visualization│         │
│   └────────────────┘     └────────────────────┘      │ run_episode_visualization   │          │
│                                                      └────────────────────────────┘          │
│                                                                    │                         │
└──────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                    │
                                                                    ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────┐
│                                 概念优化层 (example.py)                                        │
│                                                                                              │
│  ┌────────────────────────────┐    ┌─────────────────────────────┐   ┌───────────────────────┐│
│  │    概念自适应与演化         │    │   频域与语义空间融合优化      │   │   跨任务概念迁移       ││
│  │ ┌──────────────────────┐   │    │ ┌───────────────────────┐   │   │ ┌─────────────────┐   ││
│  │ │ 初始概念生成         │   │    │ │ 语义引导傅里叶层       │   │   │ │ 概念知识库      │   ││
│  │ │ generate_initial_concepts│◀─┐ │ │ SemanticGuidedFourierLayer │   │ │ ConceptTransferModule ││
│  │ └──────────────────────┘   │  │ │ └───────────────────────┘   │   │ └─────────────────┘   ││
│  │          │                 │  │ │              │              │   │           │          ││
│  │          ▼                 │  │ │              ▼              │   │           ▼          ││
│  │ ┌──────────────────────┐   │  │ │ ┌───────────────────────┐   │   │ ┌─────────────────┐   ││
│  │ │ 适应度评估           │   │  │ │ │ 语义引导傅里叶编码器   │   │   │ │ 相似概念查找    │   ││
│  │ │ evaluate_concept_fitness│  │  │ │ SemanticFourierEncoder │   │   │ │ find_similar_concepts││
│  │ └──────────────────────┘   │  │ │ └───────────────────────┘   │   │ └─────────────────┘   ││
│  │          │                 │  │ │              │              │   │           │          ││
│  │          ▼                 │  │ │              ▼              │   │           ▼          ││
│  │ ┌──────────────────────┐   │  │ │ ┌───────────────────────┐   │   │ ┌─────────────────┐   ││
│  │ │ 概念演化             │   │  └─┼─┤ 频域特征与语义融合     │   │   │ │ 渐进式迁移      │   ││
│  │ │ evolve_concepts      │───┘    │ │ forward               │   │   │ │ get_progressive_concepts││
│  │ └──────────────────────┘        │ └───────────────────────┘   │   │ └─────────────────┘   ││
│  └────────────────────────────┘    └─────────────────────────────┘   └───────────────────────┘│
│                 │                                  │                              │           │
│                 └──────────────────┬──────────────┘                              │           │
│                                    │                                             │           │
│                                    ▼                                             ▼           │
│                         ┌────────────────────────┐                  ┌─────────────────────┐  │
│                         │   概念引导的强化学习    │◀─────────────────┤  混合概念生成       │  │
│                         │   HiFNOBisimAgent      │                  │  generate_hybrid_concepts│  │
│                         └────────────────────────┘                  └─────────────────────┘  │
└──────────────────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       输出层                                                  │
│                                                                                              │
│      ┌────────────────────┐     ┌────────────────────┐      ┌────────────────────┐           │
│      │ 可视化结果         │     │ 视频生成           │      │ 性能指标报告        │           │
│      │ _save_examples     │     │ _save_video        │      │ 适应度分数/奖励      │           │
│      └────────────────────┘     └────────────────────┘      └────────────────────┘           │
│                                                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────────┘






初步加入了HiFNO
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                           状态观测序列 (图像数据/时序传感器)                                      │
└───────────────────────────────────────────┬─────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     特征提取与频域处理                                           │
│  ┌──────────────────┐           ┌───────────────────┐           ┌────────────────────────┐      │
│  │  多尺度卷积特征   │           │   傅里叶变换 (F)   │           │    频域特征增强         │      │
│  │ ┌────────────┐   │           │    ┌─────────┐    │           │   ┌────────────────┐   │      │
│  │ │   状态输入  │───┼──────────▶│    │  FFT    │    │──────────▶│   │ 频域卷积        │   │      │
│  │ └────────────┘   │           │    └─────────┘    │           │   └────────────────┘   │      │
│  └──────────────────┘           └───────────────────┘           └────────────────────────┘      │
│                                           │                                                      │
└───────────────────────────────────────────┼──────────────────────────────────────────────────────┘
                                           │
                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                  概念处理与语义引导                                              │
│                                                                                                 │
│  ┌───────────────────────────────┐     ┌───────────────────────────────────────────────────┐    │
│  │     概念自适应与演化           │     │              语义引导注意力机制                    │    │
│  │  ┌────────────┐  ┌─────────┐  │     │                                                   │    │
│  │  │ 初始概念生成├─▶│适应度评估│  │     │  ┌─────────────┐    ┌─────────────┐    ┌─────────┐  │    │
│  │  └────────────┘  └────┬────┘  │     │  │ 潜在概念变量 │───▶│ tile扩展   │───▶│   Q    │  │    │
│  │                      │        │     │  └─────────────┘    └─────────────┘    └────┬────┘  │    │
│  │  ┌────────────┐  ┌───▼─────┐  │     │                                              │       │    │
│  │  │ 概念库     ├─▶│概念演化 │  │     │  ┌─────────────┐                       ┌────▼────┐  │    │
│  │  └────────────┘  └─────────┘  │────▶│  │ 频域特征    │───────────────────────┤ Attention│  │    │
│  │                                │     │  └─────────────┘                       └────┬────┘  │    │
│  │                                │     │                                              │       │    │
│  └───────────────────────────────┘     │  ┌─────────────┐                       ┌────▼────┐  │    │
│                                         │  │ 位置编码    │───────────────────────┤   MLP   │  │    │
│                                         │  └─────────────┘                       └────┬────┘  │    │
│                                         │                                              │       │    │
│                                         └───────────────────────────────────────────────────┘    │
│                                                                    │                            │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                    │
                                                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                 特征融合与状态表示                                               │
│                                                                                                 │
│  ┌───────────────────────────────┐     ┌───────────────────────────────────────────────────┐    │
│  │   频域特征与语义表示融合       │     │              时间聚合器 (TimeAggregator)           │    │
│  │  ┌────────────┐  ┌─────────┐  │     │  ┌─────────────┐    ┌─────────────┐               │    │
│  │  │频域映射到  ├─▶│语义空间 │  │     │  │多帧状态特征 │───▶│跨帧注意力   │               │    │
│  │  │语义空间    │  │表示     │  │     │  └─────────────┘    └──────┬──────┘               │    │
│  │  └────────────┘  └────┬────┘  │     │                            │                      │    │
│  │                      │        │     │                     ┌──────▼──────┐               │    │
│  │  ┌────────────┐  ┌───▼─────┐  │────▶│                     │时序特征融合 │               │    │
│  │  │语义到频域  ├─▶│增强频域 │  │     │                     └──────┬──────┘               │    │
│  │  │注意力权重  │  │表示     │  │     │                            │                      │    │
│  │  └────────────┘  └─────────┘  │     │                     ┌──────▼──────┐               │    │
│  │                                │     │                     │ 统一状态表示 │               │    │
│  └───────────────────────────────┘     │                     └──────────────┘               │    │
│                                         └───────────────────────────────────────────────────┘    │
│                                                                                                 │
└────────────────────────────────────────────────────────────┬────────────────────────────────────┘
                                                            │
                                                            ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                 状态-动作优化与迁移学习                                          │
│                                                                                                 │
│  ┌───────────────────────────────┐     ┌───────────────────────────────────────────────────┐    │
│  │      双模拟损失优化            │     │              跨任务概念迁移                       │    │
│  │  ┌────────────┐  ┌─────────┐  │     │  ┌─────────────┐    ┌─────────────┐               │    │
│  │  │语义类内    ├─▶│动作一致 │  │     │  │相似概念查找 │───▶│渐进式迁移   │               │    │
│  │  │一致性约束  │  │性约束   │  │     │  └─────────────┘    └──────┬──────┘               │    │
│  │  └────────────┘  └────┬────┘  │     │                            │                      │    │
│  │                      │        │     │                     ┌──────▼──────┐               │    │
│  │  ┌────────────┐  ┌───▼─────┐  │────▶│                     │混合概念生成 │               │    │
│  │  │CLIP引导的  ├─▶│状态-动作│  │     │                     └──────┬──────┘               │    │
│  │  │双模拟损失  │  │优化     │  │     │                            │                      │    │
│  │  └────────────┘  └─────────┘  │     │                     ┌──────▼──────┐               │    │
│  │                                │     │                     │跨任务知识库 │               │    │
│  └───────────────────────────────┘     │                     └──────────────┘               │    │
│                                         └───────────────────────────────────────────────────┘    │
│                                                                                                 │
└────────────────────────────────────────────────────────────┬────────────────────────────────────┘
                                                            │
                                                            ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                  优化的动作输出                                                 │
│                                                                                                 │
│                 ┌────────────────────────────────────────────────────────┐                      │
│                 │   针对周期性任务的高效动作策略 (Actor-Critic网络)      │                      │
│                 └────────────────────────────────────────────────────────┘                      │
│                                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘




总体框架
┌───────────────────────────────────────────────────────────────────────────┐
│                                 输入层                                     │
│   ┌─────────────────┐        ┌─────────────────┐     ┌─────────────────┐  │
│   │   状态观测序列   │        │   任务描述文本   │     │   历史任务数据   │  │
│   └────────┬────────┘        └────────┬────────┘     └────────┬────────┘  │
└────────────┼─────────────────────────┼─────────────────────────┼───────────┘
             │                         │                         │
             ▼                         │                         ▼
┌─────────────────────┐                │              ┌─────────────────────┐
│                     │                │              │                     │
│  概念自适应演化     │◀──┐            │              │  跨任务概念迁移     │
│                     │   │            │              │                     │
└─────────┬───────────┘   │            │              └──────────┬──────────┘
          │               │            │                         │
          │               │            ▼                         │
          │               │  ┌─────────────────────┐             │
          └───────────────┼─►│                     │◄────────────┘
                          │  │  多尺度层次化       │
                          │  │  频域特征提取       │
                          │  │                     │
                          │  └─────────┬───────────┘
                          │            │
                          │            ▼
                          │  ┌─────────────────────┐
                          │  │                     │
                          │  │  频域与语义空间     │
                          │  │  融合优化           │
                          │  │                     │
                          │  └─────────┬───────────┘
                          │            │
                          │            ▼
                          │  ┌─────────────────────┐
                          │  │                     │
                          └──┤  语义引导的         │
                             │  行为一致性优化     │
                             │                     │
                             └─────────┬───────────┘
                                       │
                                       ▼
┌───────────────────────────────────────────────────────────────────────────┐
│                                 输出层                                     │
│   ┌─────────────────┐        ┌─────────────────┐     ┌─────────────────┐  │
│   │  优化动作策略   │        │   增强概念库     │     │  周期任务性能    │  │
│   └─────────────────┘        └─────────────────┘     └─────────────────┘  │
└───────────────────────────────────────────────────────────────────────────┘